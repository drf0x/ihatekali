<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="width=device-width,initial-scale=1" name="viewport">
  <meta name="google" content="notranslate" />
  <meta name="msapplication-tap-highlight" content="no">
  <link rel="stylesheet"href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"/>
  <link href="./maincss.css" rel="stylesheet">

  <title>Lockdown</title>  

</head>

<header style="position: relative;width: 100%;z-index: 1000;">
  <div class="page-header">
    <div class="logo"></div>
   <a id="menu-icon" class="menu-icon" onclick="onMenuClick()">
    <i class="fa fa-bars"></i>
   </a>

  <div id="navigation-bar" class="nav-bar" >
      <a class="press"href="./index.html">HÌ´Ì”ÌŠÌ‘ÌÌ…Í˜Ì›Í„Í—Ì¡ÌÌŸoÌ·Ì¾Í’Ì¾Ì‘ÌƒÌŒÌ’Ì”Ì©Ì¨mÌ¸Í€ÌŒÍƒÌ¦Í“eÌ¸ÌÍÌ®Ì–Í…Ì¨Ì³Í•</a>        <!-- Home -->
      <a class="press"href="./production.html">PÌµÌÌ“ÍÍ‘ÍƒÍ‚ÌƒÌ™Ì­ÍˆÍ‡Ì­Ì®Í‰ÍÌ¥rÌ¶ÌÌ¢Ì«Í•Ì¯Í‡Ì³Ì¦Í–Ì¼Ì¢oÌµÌ½Ì“Í—ÌÌÌÌ„Í™ÍÌÍ™Ì±dÌµÌŠÌ‹Í„ÌÌ€Í†Ì®ÌªÍ‰ÍšÌ˜Í‡ÍÍˆÌ¡Ì–uÌµÍŠÍ€Ì‚Ì›ÌˆÌ€ÍŒÌ“ÌÌ‰ÍÌ™Í“Ì¡Ì¢cÌ¸ÍƒÌŒÍ’Ì€ÌŠÌ¢tÌµÍ›ÍˆÌÌ–iÌµÌ†ÍÍ€Ì£Ì¯Ì¼Ì®Ì Í…oÌ·ÌÌÍÍŒÌÌ±Ì²ÌÌ³Ì°Ì¥Ì­Ì§nÌ·Ì€ÍÌ½ÌšÍÌ†ÍÍ‚Ì‰Ì Ì™Í”Ì™Ìœ</a>         <!-- Production -->
      <a class="press"href="./mixmast.html">MÌ·Í‘ÍÌ”ÌÌ©Ì³ÍÌÌ¬Ì­iÌ¸ÍƒÌ›Ì€Í‘ÌÌ‡Í‘Í„ÌƒÌÌ¯Ì—Ì«xÌµÌ“Ì‹ÍÌ„ÌÍÌ‚ÍƒÌ½Í ÌµÌ”Í‘ÌƒÍ’ÌÌ¦ÌÌªÌ°ÍˆÌªÍ™Ì§Ì—aÌ¶Ì•ÍŒÌ±Ì—Ì­Ì©ÌœÍ…Ì²ÍšÌ—Ì™nÌµÍ’Ì»Ì°Ì—ÌœdÌ¶Í†Ì‰Ì½Ì„ÌÍ‚Ì‰Í€ÍÌ®Í–Í•Ì¤Í“Ì¢Ì¨Ì¨Ì Ì´Ì‡Í„Ì•Ì’ÌŒÌ¤ÌªÌ–Ì¨Ì¦MÌ·Í‘Í†ÍˆÌ®Ì¹Ì¼Ì²aÌ·ÌÌ€Ì¼Ì¹Í™sÌ·Í‘Í„Ì³tÌ¸Ì“ÌŠÌÍ—ÌÌ ÍˆÌ¼Ì¬Ì»eÌµÌ†Í›Ì­ÍœÌ¼Ì±ÍšrÌ¸Í„Í‹ÍŒÌ‰Ì‘ÍŠÌ’Ì‹Ì‘Í„Ì­ÍˆÍ–Ì¢ÌÌ©iÌ¶Ì½Í†Í‚ÍŒÌ”ÌºÍ“Ì˜Ì¬Ì­ÌŸÍ”ÍnÌ·Ì›Í˜Ì€ÍÍ„Ì€Ì•ÌšÌ’Í—Í“gÌ·Í Ì†Í‚Ì‹Í‚Í‘Í„ÍŒÍ‰</a>       <!-- Mix and Mastering -->
      <a class="press"href="./djmix.html">DÌ¶ÌŒÌŒÌÌ©Ì¡Ì¯Ì¯ÌªÍ–JÌ¸Ì‡ÍŠÌ‡Ì•ÌÍÌ¿ÍÍ‚Ì¹Ì¤Ì¨Ì—ÌºÍ ÌµÍ‘Í’ÌŒÍ ÌÍÌŒÍ—Ì“Ì‡Ì²Í…Ì—Ì¼Ì©ÍÌ¹MÌ´Í ÌšÍÍ„Í‚ÍÍ†ÍƒÌˆÍ•Ì¨Ì˜iÌµÍ—ÌÌ­Í‰ÍˆxÌµÌŒÍ Ì½ÌšÌ‰Í†Ì¨ÌªÌ¦Ì°eÌµÌ›ÍÌ¿ÌƒÍ†ÌÌ“Í‚Ì„Ì‡Ì¬Ì£Í™Ì˜Ì©Í–sÌ¶Ì€ÍÍ†Ì½ÌÌ•Í‚ÌƒÌ”Ì²Í‰Ì»Ì—ÍœÌŸÌ©Í“</a>         <!-- DJ Mixes -->
      <a class="press"href="./writeups.html">WÌ´ÌÌ’Ì˜ÌÌ¦Ì®Ì™Ì¢ÌœÌ¤rÌ¶ÌƒÌÌ«Ì¼Ì»ÍˆÌ¼iÌ¸Ì‘Ì…Í‹Í Ì„Ì›Í Ì‹Ì‰Í™Ì¦Í”Í“Ì¬tÌ¶Í„Ì©Ì™Ì¡ÍšÌºÌ¼eÌµÌ„ÌšÌ•Ì„Ì•Í’Í‘ÌÌ›Ì±Ì£uÌ´ÍÌÍ†Ì”ÍÌ¦Í•ÌºÌ¢Ì¨ÍœÍ–pÌ·Í’Ì€ÌˆÌªsÌ¶ÌÌÍ™Í•Ì¨Ì¬Ì§</a>     <!-- Writeups -->
  </div>
   <div class="header-right"></div>
  </div>
 </header>

 <font color="white">
    <div class="paragragh">            
     <body>  
  <div class="writetextbox">                
  <font color=#A33>
    <div class="maintext"
   <br />ğ•‹ğ• ğ••ğ•’ğ•ª ğ•¨ğ•– ğ•’ğ•£ğ•– ğ•™ğ•’ğ•”ğ•œğ•šğ•Ÿğ•˜ ğ•’ ğ•ğ•–ğ••ğ•šğ•¦ğ• ğ•ğ•–ğ•§ğ•–ğ• ğ•“ğ• ğ•© ğ• ğ•Ÿ ğ•¥ğ•£ğ•ªğ•™ğ•’ğ•”ğ•œğ•ğ•–, ğ•šğ•¥ ğ•šğ•Ÿğ•§ğ• ğ•ğ•§ğ•–ğ•¤ ğ•’ ğ•¤ğ•šğ•ğ•¡ğ•ğ•– ğ•¤ğ•¢ğ• ğ•šğ•Ÿğ•›ğ•–ğ•”ğ•¥ğ•šğ• ğ•Ÿ ğ•¥ğ•  ğ•˜ğ•–ğ•¥ ğ•¥ğ•  ğ•¥ğ•™ğ•– ğ•’ğ••ğ•ğ•šğ•Ÿ ğ•¡ğ•’ğ•Ÿğ•–ğ• ğ•¥ğ•™ğ•–ğ•Ÿ ğ•¦ğ•¡ğ•ğ• ğ•’ğ••ğ•šğ•Ÿğ•˜ ğ•’ğ•Ÿğ•• ğ•£ğ•¦ğ•Ÿğ•Ÿğ•šğ•Ÿğ•˜ ğ•’ ğ•£ğ•–ğ•§ğ•–ğ•£ğ•¤ğ•– ğ•¤ğ•™ğ•–ğ•ğ• ğ•¥ğ•  ğ•˜ğ•–ğ•¥ ğ•¨ğ•–ğ•“.
  ğ•‹ğ•  ğ•˜ğ•–ğ•¥ ğ•£ğ• ğ• ğ•¥ ğ•¨ğ•– ğ•’ ğ•¥ğ•’ğ•¤ğ•œğ•–ğ•• ğ•¨ğ•šğ•¥ğ•™ ğ•’ ğ•¤ğ•”ğ•£ğ•šğ•¡ğ•¥ ğ•¥ğ•™ğ•’ğ•¥ ğ•¦ğ•¤ğ•–ğ•¤ â„‚ğ•ğ•’ğ•ğ”¸ğ• ğ•’ğ•Ÿğ•• ğ•¨ğ•– ğ•”ğ•£ğ•–ğ•’ğ•¥ğ•– ğ• ğ•¦ğ•£ ğ• ğ•¨ğ•Ÿ ğ•£ğ•¦ğ•ğ•– ğ•¥ğ•  ğ•£ğ•–ğ•’ğ•• ğ•’ğ•Ÿğ•ª ğ•—ğ•šğ•ğ•– ğ•¨ğ•– ğ•¨ğ•’ğ•Ÿğ•¥.</p><br>
 </font>
 

<div class="hacked">
  <font size=2>ğ‡ğšğœğ¤ğğ ğ›ğ² <font color=#A33>KÌ´Í‹ÌÍ—Ì„Í†Ì’Í‹ÌˆÌ¥Ì˜ÍšÌ²Ì¤Ì³aÌ´Ì•ÌÌ‘Í ÌƒÌ•Ì”ÍŠÌÌ¤Ì¹Ì©ÍšÌ¨lÌ´ÌŒÌÍƒÍÌ”Ì…Ì›Í˜Ì­Ì¥Ì°Ì¤Ì Ì§Ì±Ì¥ÌºiÌµÌ‘Ì‰ÌˆÌœÌœÌ—</font></font>
  </div>
  
<div class="writeups">
  
<br /><br /><br />
<strong>Difficulty:</strong> <font color="orange">Medium</font><br /><br />
<strong>Points:</strong> 60<br /><br />
<strong>Room Link:</strong> <a href="https://tryhackme.com/room/lockdown"><font color="grey">Click Here</font></a>
<br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />



<strong>Starting off with nmap</strong><br /><br />
<span class="highlight">nmap -v -sV -sC -oA nmap lockdown.thm</span><br /><br />

<strong>Scan Results:</strong><br />
<pre>
<div class="nmap">
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 27:1d:c5:8a:0b:bc:02:c0:f0:f1:f5:5a:d1:ff:a4:63 (RSA)
|   256 ce:f7:60:29:52:4f:65:b1:20:02:0a:2d:07:40:fd:bf (ECDSA)
|_  256 a5:b5:5a:40:13:b0:0f:b6:5a:5f:21:60:71:6f:45:2e (ED25519)
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
| http-cookie-flags: 
|   /: 
|     PHPSESSID: 
|_     httponly flag not set
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: Coronavirus Contact Tracer
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</div> 
</pre>
<br /><br />

<strong>Looks like just http and ssh, lets them out</strong><br /><br />
<strong>Website Visit:</strong> When we first visit the website, we get an admin login panel.<br /><br />
<img width="45%" src="lockdown/102-1.png" alt="Admin Login Panel" /><br /><br />

<strong>Gobuster Running:</strong> While I had gobuster running, I tried common user and passwords and simple SQL injections, and I got a log in!<br /><br />
<img width="45%" src="lockdown/102-2.png" alt="Gobuster Results" /><br /><br />

<strong>SQL Injection:</strong> Using <span class="highlight">' or 1=1 -- -</span> as the user and anything for the password, we get access to the admin panel!<br /><br />
After looking around for a bit, I went to /admin/?page=system_info and saw I could upload a file to logo, and it had no restrictions, so I uploaded a PHP reverse shell.<br /><br />
<img width="45%" src="lockdown/102-3.png" alt="File Upload" /><br /><br />

<strong>Finding the Shell:</strong> I went looking around trying to find a page that would run the logo page and give me a shell (Make sure you have your nc listener going).<br /><br />
Then I found that when I logged out of the admin panel and visited <a href="http://contacttracer.thm">http://contacttracer.thm</a>, it loads the logo and runs my PHP reverse shell!<br /><br />
<img width="45%" src="lockdown/102-4.png" alt="Reverse Shell" /><br /><br />

<strong>Cool, we got a shell!</strong> <br /><br />
Let's enumerate now to get user. First place I always look is /var/www/html/config.php, so let's look there.<br /><br />
<img width="45%" src="lockdown/102-5.png" alt="Config File" /><br /><br />

<strong>Interesting Path:</strong> Seems to have no creds, but it does show an interesting path: classes/DBConnection.php. Let's check it out.<br /><br />
<img width="45%" src="lockdown/102-6.png" alt="DB Connection" /><br /><br />

<strong>Database Credentials:</strong> Nice, we got creds to cts_db database. Let's use MySQL to log into it.<br /><br />
<span class="highlight">mysql -u cts -p</span><br /><br />
<img width="45%" src="lockdown/102-7.png" alt="MySQL Login" /><br /><br />

<span class="highlight">use cts_db;</span><br /><br />
<span class="highlight">show tables;</span><br /><br />
<img width="45%" src="lockdown/102-8.png" alt="Show Tables" /><br /><br />

<strong>Users Table:</strong> Users look interesting, let's see what's inside it.<br /><br />
<img width="45%" src="lockdown/102-9.png" alt="Users Table" /><br /><br />

<strong>Password Hash:</strong> Cool, we got a password hash and it seems to be MD5. Let's crack it. I just used an online cracking website.<br /><br />
<img width="45%" src="lockdown/102-10.png" alt="Password Hash" /><br /><br />

<strong>Cracked Credentials:</strong> Cool, we get creds. Let's use it on cyrus!<br />
cyrus : {Redacted}<br /><br />
<img width="45%" src="lockdown/102-11.png" alt="Cyrus Credentials" /><br /><br />

<strong>User Access:</strong> Cool, we get user. I su'd to cyrus on my other shell and imported my SSH key into his authorized_keys so I could SSH in.<br /><br />
<img width="45%" src="lockdown/102-12.png" alt="SSH Key" /><br /><br />

<strong>Running scan.sh as Root:</strong> Okay, looks like we can run scan.sh as root. Let's check it out.<br /><br />
<img width="45%" src="lockdown/102-13.png" alt="Scan Script" /><br /><br />

<strong>ClamAV and Yara Rules:</strong> Not going to lie, this had me confused for a while, but after a large amount of enumeration, I found out ClamAV supports Yara rules. If we have access to the directory to which the rules are stored, we could import our own rule and make ClamAV do what we want. Let's check if we can do that!<br />
<a href="https://docs.clamav.net/manual/Signatures/YaraRules.html">ClamAV Yara Rules Documentation</a><br /><br />

After finding the main .conf file /etc/clamav/freshclam.conf, we can see inside it where the Database Directory is!<br /><br />
<img width="45%" src="lockdown/102-14.png" alt="Freshclam Config" /><br /><br />

<strong>Database Directory:</strong> It seems to be /var/lib/clamav.<br /><br />
<img width="45%" src="lockdown/102-15.png" alt="Database Directory" /><br /><br />

<strong>Full Privileges:</strong> Funny enough, we have full read-write privileges to it! Let's make some rules.<br /><br />
First, I removed the default rule.<br /><br />
<img width="45%" src="lockdown/102-16.png" alt="Remove Default Rule" /><br /><br />

<strong>Creating Our Rule:</strong> Now let's make our rule.<br />
<strong>rule.yara:</strong><br /><br />
<div class="codebox">
    <pre>
rule test {
strings:
    $show = "root"
condition:
    $show
    </pre>
</div><br />

<strong>Rule Functionality:</strong> So what this rule does is search for the string â€œrootâ€ within the file we scan. If it finds a match within the file we scan, it flags it as a virus and outputs it to /home/cyrus/quarantine/ where we can then read it! Now you could just scan for the string â€œTHMâ€ within /root/root.txt, but where's the fun in getting the root flag and not actually getting root on the system?<br /><br />
<img width="45%" src="lockdown/102-17.png" alt="Yara Rule" /><br /><br />

<strong>Running the Scan:</strong> So I ran scan.sh as root and scanned /etc/shadow, and it copied the file! Let's read it.<br /><br />
<img width="45%" src="lockdown/102-18.png" alt="Shadow File" /><br /><br />

<strong>No Root Hash:</strong> Sadly, there is no root hash, but there is a hash for maxine. Let's crack it!<br /><br />
<span class="highlight">hashcat -O -m 1800 '$6$/{Redacted}' /usr/share/wordlists/rockyou.txt</span><br /><br />
<img width="45%" src="lockdown/102-19.png" alt="Hashcat" /><br /><br />

<strong>Logging in as Maxine:</strong> Nice, we cracked it. Now let's log in as maxine!<br />
maxine : {Redacted}<br /><br />
<img width="45%" src="lockdown/102-20.png" alt="Maxine Login" /><br /><br />

<strong>Sudo Access:</strong> Seems we can run anything as sudo!<br /><br />
<span class="highlight">sudo su</span><br /><br />
<img width="45%" src="lockdown/102-21.png" alt="Sudo Access" /><br /><br />

<strong>Conclusion:</strong> And as easy as that, we're root!<br /><br /><br /><br /><br /><br /><br /><br /><br />

<div class="binary"><font color=#A33>01110100 01101000 01100001 01101110 01101011 00100000 01111001 01101111 01110101</font></div><br /><br /><br /><br /><br /><br />

</font>
</div>
</div>
                </div>
              </h1>
  </div>

<style>
img {
  width: 40%;
  display: block;
  margin-left: auto;
  margin-right: auto;
  margin-top: 30px;
  margin-bottom: 30px;
}

@media only screen and (max-width: 600px) {
  img {
    width: 80%;
    display: block;
    margin-left: auto;
    margin-right: auto;
    margin-top: 30px;
    margin-bottom: 30px;
  }
}
</style>


<body class="minimal" >
  <body style="background-color: black;">

    <div class="bg-animation">
        <div id="stars"></div>
        <div id="stars2"></div>
        <div id="stars3"></div>
        <div id="stars4"></div>
    </div>
  </body>
</body>
</body>

<script type="text/javascript" src="./mainjs.js"></script></body>

</html>